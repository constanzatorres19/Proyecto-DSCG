<!--
  Mockups funcionales (Sprint 2) - Sistema de Control de Turnos
  Archivo: Mockups_HTML_Sprint2_McBalmaceda.html
  Descripción: Single-file HTML + CSS + JS que simula pantallas clave (Gerente/RRHH y Crew)
  - Navegación entre pantallas (login -> dashboards -> formularios clave)
  - Planificación manual y subida de plantilla (CSV simple) para RR.HH.
  - Visualización de planilla, confirmación de turnos, solicitud de cambio para Crew
  - Comentarios abundantes explicando cada bloque para que puedas modificarlo

  Instrucciones de uso:
  1) Guarda este contenido como "Mockups_HTML_Sprint2_McBalmaceda.html" en tu PC.
  2) Abre el archivo con un navegador (Chrome, Edge, Firefox).
  3) Interactúa: usa el login simulado (elige rol Gerente o Crew) y navega.

  Nota: Es un mockup funcional (front-end). No tiene backend ni persistencia real - los datos
  se mantienen en memoria del navegador durante la sesión.
-->

<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Mockups SCT-McB - Sprint 2</title>
  <style>
    /* ==========================================
       Estilos globales - paleta inspirada en McDonald's
       Amarillo: #FFD600   (fondo principal)
       Rojo:     #FF4D4D   (botones/targets)
       Texto oscuro para contraste
       ========================================== */
    :root{
      --mc-yellow:#ffd600;
      --mc-red: #ff4d4d;
      --mc-dark: #222;
      --card-radius:16px;
      --gap:14px;
      font-family: Inter, system-ui, Arial, sans-serif;
    }
    html,body{height:100%;margin:0;background:linear-gradient(#fff,#fff);}
    .app{min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;background:var(--mc-yellow);} 

    /* Contenedor del mockup */
    .frame{width:100%;max-width:1100px;background:white;border-radius:18px;padding:18px;box-shadow:0 6px 28px rgba(0,0,0,0.12);}

    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    .brand{display:flex;align-items:center;gap:12px}
    .logo{width:48px;height:48px;border-radius:10px;background:var(--mc-red);display:flex;align-items:center;justify-content:center;color:white;font-weight:700}
    h1{font-size:18px;margin:0;color:var(--mc-dark)}
    .role-badge{background:var(--mc-red);color:white;padding:8px 12px;border-radius:999px}

    /* Layout principal - columnas */
    .container{display:grid;grid-template-columns:320px 1fr;gap:18px}

    /* Sidebar / menú */
    .sidebar{background:linear-gradient(#fff, #fff);border-radius:12px;padding:12px;border:2px solid rgba(0,0,0,0.03)}
    .side-block{display:flex;flex-direction:column;gap:10px}
    button.menu-btn{background:var(--mc-red);color:white;border:none;padding:10px;border-radius:10px;font-weight:600;cursor:pointer}
    .small{font-size:13px;color:#333}

    /* Main content area */
    .main{background:#fff;border-radius:12px;padding:14px;min-height:460px;border:2px solid rgba(0,0,0,0.03)}
    .screen{display:none} /* cada 'pantalla' del mockup */
    .screen.active{display:block}

    /* Formularios y tablas */
    form{display:flex;flex-direction:column;gap:10px}
    label{font-weight:600;font-size:13px}
    input[type="text"], input[type="time"], input[type="date"], select, textarea{padding:8px;border-radius:8px;border:1px solid #ddd;font-size:14px}
    textarea{min-height:80px}
    .row{display:flex;gap:10px}
    .row .col{flex:1}
    .muted{color:#666;font-size:13px}

    table{width:100%;border-collapse:collapse}
    th,td{padding:8px;border-bottom:1px solid #eee;text-align:left}
    th{background:#fafafa}

    .actions{display:flex;gap:8px;align-items:center}
    .btn{padding:8px 12px;border-radius:8px;border:none;cursor:pointer}
    .btn-primary{background:var(--mc-red);color:white}
    .btn-sec{background:#f2f2f2}
    .success{background:#2ecc71;color:white}

    /* Vista previa CSV */
    .preview{background:#fff7e6;padding:10px;border-radius:10px;border:1px dashed #ffd98a}

    /* Responsivo */
    @media(max-width:900px){
      .container{grid-template-columns:1fr}
      .sidebar{order:2}
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="frame">

      <!-- Header con marca y rol actual (se actualiza mediante JS) -->
      <header>
        <div class="brand">
          <div class="logo">M</div>
          <div>
            <h1>Sistema de Control de Turnos - McBalmaceda</h1>
            <div class="muted">Mockup funcional - Sprint 2</div>
          </div>
        </div>
        <div id="headerRole" class="role-badge">Rol: Invitado</div>
      </header>

      <div class="container">

        <!-- ========== SIDEBAR DE NAVEGACIÓN ========== -->
        <aside class="sidebar">
          <!-- Este menú simula el dashboard lateral (igual que tu mockup s1) -->
          <div class="side-block">
            <div id="userBox">
              <!-- Datos de usuario / quick info (rellenado por JS) -->
              <div class="muted">Usuario:</div>
              <div id="userName" style="font-weight:700">(no has iniciado sesión)</div>
            </div>

            <!-- Botones de navegación: cada botón muestra una 'pantalla' diferente en el main -->
            <button class="menu-btn" onclick="nav('home')">Home</button>

            <!-- Para Gerente / RR.HH.:
                 - Planificar posiciones semanales
                 - Visualizar planilla mensual
                 - Revisar solicitudes de cambio
            -->
            <div id="menuGerente" style="display:none">
              <button class="btn btn-sec" onclick="nav('planificar')">Planificar posiciones</button>
              <button class="btn btn-sec" onclick="nav('planilla')">Visualizar planilla</button>
              <button class="btn btn-sec" onclick="nav('revisarSolicitudes')">Revisar solicitudes</button>
            </div>

            <!-- Para Crew:
                 - Visualizar planilla personal
                 - Solicitar cambio de turno
                 - Historial de turnos
            -->
            <div id="menuCrew" style="display:none">
              <button class="btn btn-sec" onclick="nav('miPlanilla')">Mi planilla</button>
              <button class="btn btn-sec" onclick="nav('solicitarCambio')">Solicitar cambio</button>
              <button class="btn btn-sec" onclick="nav('historial')">Historial</button>
            </div>

            <!-- Botón para abrir el login simulado -->
            <div style="margin-top:10px">
              <button class="btn" id="btnLogout" style="display:none" onclick="logout()">Cerrar sesión</button>
              <button class="btn btn-primary" id="btnLogin" onclick="nav('login')">Iniciar sesión</button>
            </div>

            <div style="margin-top:18px" class="muted">Notas:</div>
            <div class="muted" style="font-size:13px">Este mockup guarda datos en memoria del navegador. Recarga limpiará todo.</div>
          </div>
        </aside>

        <!-- ========== ÁREA PRINCIPAL (pantallas dinámicas) ========== -->
        <main class="main">

          <!-- ---------- PANTALLA: LOGIN (simulado) ---------- -->
          <section id="login" class="screen active">
            <h2>Login (simulado)</h2>
            <p class="muted">Selecciona un rol para simular la sesión. No hay autenticación real.</p>
            <form onsubmit="event.preventDefault(); doLogin()">
              <label>Usuario (nombre)</label>
              <input id="loginUsuario" type="text" placeholder="Ej: Constanza" required>

              <label>Rol</label>
              <select id="loginRol">
                <option value="crew">Crew</option>
                <option value="gerente">Gerente / RR.HH.</option>
              </select>

              <div class="row">
                <div class="col">
                  <button class="btn btn-primary" type="submit">Ingresar</button>
                </div>
                <div class="col">
                  <button class="btn btn-sec" type="button" onclick="seedDemo()">Cargar demo (ejemplo)</button>
                </div>
              </div>
            </form>
          </section>

          <!-- ---------- PANTALLA: HOME (post-login) ---------- -->
          <section id="home" class="screen">
            <h2>Home</h2>
            <div class="muted">Bienvenido, usa el menú lateral para navegar entre las funciones clave.</div>
            <div style="margin-top:12px">
              <div style="display:flex;gap:12px;flex-wrap:wrap">
                <div style="flex:1;min-width:220px;background:#fff7e6;padding:12px;border-radius:10px">
                  <strong>Planilla actual:</strong>
                  <div id="homePlanillaInfo" class="muted">Sin datos cargados</div>
                </div>
                <div style="flex:1;min-width:220px;background:#fff7e6;padding:12px;border-radius:10px">
                  <strong>Solicitudes pendientes:</strong>
                  <div id="homeSolicitudesInfo" class="muted">0</div>
                </div>
              </div>
            </div>
          </section>

          <!-- ---------- PANTALLA: PLANIFICAR (Gerente) ---------- -->
          <section id="planificar" style="display:none;">
    <!-- Título de la pantalla -->
    <h2>Planificar Posiciones</h2>

    <!-- Selección de rango de fechas para definir la semana -->
    <div class="card">
        <h3>Definir semana de trabajo</h3>
        <label>Fecha inicio de semana:</label>
        <input type="date" id="weekStart">

        <label>Fecha fin de semana:</label>
        <input type="date" id="weekEnd">

        <button onclick="definirSemana()">Confirmar semana</button>
    </div>

    <!-- Formulario para ingresar turnos -->
    <div class="card">
        <h3>Crear turnos dentro de la semana definida</h3>
        <label>Empleado:</label>
        <input type="text" id="empNombre">

        <label>Fecha del turno:</label>
        <input type="date" id="turnoFecha">

        <label>Hora inicio:</label>
        <input type="time" id="horaInicio">

        <label>Hora término:</label>
        <input type="time" id="horaFin">

        <button onclick="agregarTurno()">Agregar turno</button>
    </div>

    <!-- Tabla de turnos creados -->
    <div class="card">
        <h3>Turnos creados para esta semana</h3>
        <table id="tablaPlanificacion" border="1" style="width:100%; text-align:center;">
            <thead>
                <tr>
                    <th>Empleado</th>
                    <th>Fecha</th>
                    <th>Inicio</th>
                    <th>Término</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <button onclick="publicarPlanilla()">Publicar planilla semanal</button>
    </div>
</section>


          <!-- ---------- PANTALLA: VISUALIZAR PLANILLA (Gerente) ---------- -->
          <section id="planilla" class="screen">
            <h2>Planilla publicada</h2>
            <div class="muted">Esta vista simula la planilla que verán los empleados una vez publicada.</div>
            <div style="margin-top:10px">
              <table id="tablePublicada">
                <thead>
                  <tr><th>Empleado</th><th>Fecha</th><th>Inicio</th><th>Fin</th><th>Cargo</th><th>Área</th></tr>
                </thead>
                <tbody></tbody>
              </table>
            </div>
          </section>

          <!-- ---------- PANTALLA: REVISAR SOLICITUDES (Gerente) ---------- -->
          <section id="revisarSolicitudes" class="screen">
            <h2>Solicitudes de cambio - Revisión</h2>
            <p class="muted">Validar y aprobar/rechazar solicitudes enviadas por el personal.</p>
            <table id="tableSolicitudes">
              <thead><tr><th>Empleado</th><th>Turno original</th><th>Turno pedido</th><th>Motivo</th><th>Estado</th><th>Acciones</th></tr></thead>
              <tbody></tbody>
            </table>
          </section>

          <!-- ---------- PANTALLA: MI PLANILLA (Crew) ---------- -->
          <section id="miPlanilla" class="screen">
            <h2>Mi planilla</h2>
            <p class="muted">Vista personalizada: el sistema filtra la planilla por el nombre del usuario (simulado).</p>
            <table id="tableMiPlanilla"><thead><tr><th>Fecha</th><th>Inicio</th><th>Fin</th><th>Cargo</th><th>Área</th><th>Acción</th></tr></thead><tbody></tbody></table>
          </section>

          <!-- ---------- PANTALLA: SOLICITAR CAMBIO (Crew) ---------- -->
          <section id="solicitarCambio" class="screen">
            <h2>Solicitar cambio de turno</h2>
            <p class="muted">Selecciona el turno que quieres cambiar y sugiere una alternativa.</p>
            <form onsubmit="event.preventDefault(); enviarSolicitud()">
              <label>Selecciona turno (fecha - inicio - fin)</label>
              <select id="selectMisTurnos"></select>

              <label>Turno sugerido (fecha/hora)</label>
              <input id="sugFecha" type="date" required>
              <div class="row">
                <div class="col"><input id="sugInicio" type="time" required></div>
                <div class="col"><input id="sugFin" type="time" required></div>
              </div>

              <label>Motivo del cambio</label>
              <textarea id="motivoCambio" placeholder="Explica brevemente por qué solicitas el cambio" required></textarea>

              <div style="display:flex;gap:8px;margin-top:8px;">
                <button class="btn btn-primary" type="submit">Enviar solicitud</button>
                <button class="btn" type="button" onclick="nav('miPlanilla')">Cancelar</button>
              </div>
            </form>
          </section>

          <!-- ---------- PANTALLA: HISTORIAL (Crew) ---------- -->
          <section id="historial" class="screen">
            <h2>Historial de solicitudes</h2>
            <table id="tableHistorial"><thead><tr><th>Fecha solicitud</th><th>Turno original</th><th>Turno pedido</th><th>Estado</th></tr></thead><tbody></tbody></table>
          </section>

        </main>
      </div>
    </div>
  </div>

  <script>
    /* ======================================
       Variables en memoria (simulan DB temporal)
       - planillaTmp: lista de turnos añadidos (antes de publicar)
       - planillaPublicada: turnos disponibles para empleados
       - solicitudes: solicitudes de cambio generadas por crew
       ====================================== */

    let currentUser = null; // {name, role}
    let planillaTmp = [];
    let planillaPublicada = [];
    let solicitudes = [];

    // Navegación simple entre "pantallas" (secciones) del mockup
    function nav(screenId){
      document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
      const screen = document.getElementById(screenId);
      if(screen) screen.classList.add('active');

      // mostrar/ocultar menús según rol
      document.getElementById('menuGerente').style.display = (currentUser && currentUser.role==='gerente') ? 'block' : 'none';
      document.getElementById('menuCrew').style.display = (currentUser && currentUser.role==='crew') ? 'block' : 'none';
      document.getElementById('btnLogin').style.display = currentUser ? 'none' : 'inline-block';
      document.getElementById('btnLogout').style.display = currentUser ? 'inline-block' : 'none';

      // Actualizar headerRole
      document.getElementById('headerRole').innerText = currentUser ? `Rol: ${currentUser.role==='gerente'?'Gerente':'Crew'}` : 'Rol: Invitado';

      // acciones por pantalla
      if(screenId==='miPlanilla') renderMiPlanilla();
      if(screenId==='planilla') renderPlanillaPublicada();
      if(screenId==='revisarSolicitudes') renderSolicitudes();
      if(screenId==='historial') renderHistorial();
      if(screenId==='solicitarCambio') populateMisTurnosSelect();
    }

    // Simula login (sin seguridad) - actualiza UI y menus
    function doLogin(){
      const nombre = document.getElementById('loginUsuario').value.trim();
      const rol = document.getElementById('loginRol').value;
      if(!nombre) return alert('Ingresa nombre');
      currentUser = {name:nombre, role: rol};
      document.getElementById('userName').innerText = nombre + ' (' + (rol==='gerente'?'Gerente':'Crew') + ')';
      document.getElementById('headerRole').innerText = `Rol: ${rol==='gerente'?'Gerente':'Crew'}`;
      // mostrar home por defecto
      nav('home');
    }

    function logout(){
      if(!confirm('Cerrar sesión?')) return;
      currentUser = null;
      document.getElementById('userName').innerText = '(no has iniciado sesión)';
      document.getElementById('headerRole').innerText = 'Rol: Invitado';
      nav('login');
    }

    /* ---------- FUNCIONES PLANILLA ---------- */

    // Alterna el formulario manual de creación de turnos
    function toggleManual(){
      const el = document.getElementById('manualForm');
      el.style.display = el.style.display==='none' ? 'block' : 'none';
    }

    // Añade un turno desde el formulario manual
    function addTurnoFromForm(){
      const emp = document.getElementById('fEmpleado').value.trim();
      const cargo = document.getElementById('fCargo').value;
      const fecha = document.getElementById('fFecha').value;
      const inicio = document.getElementById('fInicio').value;
      const fin = document.getElementById('fFin').value;
      const area = document.getElementById('fArea').value.trim();
      if(!emp||!fecha||!inicio||!fin) return alert('Completa los campos requeridos');
      planillaTmp.push({empleado:emp, fecha, inicio, fin, cargo, area});
      renderTablaTurnos();
      document.getElementById('formTurno').reset();
    }

    // Renderiza la tabla editable de turnos (planilla temporal)
    function renderTablaTurnos(){
      const tbody = document.querySelector('#tableTurnos tbody');
      tbody.innerHTML = '';
      planillaTmp.forEach((t,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.empleado}</td><td>${t.fecha}</td><td>${t.inicio}</td><td>${t.fin}</td><td>${t.cargo}</td><td>${t.area}</td><td class="actions"><button class='btn btn-sec' onclick='editarTurno(${i})'>Editar</button><button class='btn' onclick='borrarTurno(${i})'>Eliminar</button></td>`;
        tbody.appendChild(tr);
      })
    }

    function editarTurno(i){
      const t = planillaTmp[i];
      // Simple: rellenar el formulario con los datos y eliminar la fila original
      document.getElementById('fEmpleado').value = t.empleado;
      document.getElementById('fCargo').value = t.cargo;
      document.getElementById('fFecha').value = t.fecha;
      document.getElementById('fInicio').value = t.inicio;
      document.getElementById('fFin').value = t.fin;
      document.getElementById('fArea').value = t.area;
      planillaTmp.splice(i,1);
      renderTablaTurnos();
      // abrir el formulario automáticamente
      document.getElementById('manualForm').style.display = 'block';
    }

    function borrarTurno(i){
      if(!confirm('Eliminar turno?')) return;
      planillaTmp.splice(i,1);
      renderTablaTurnos();
    }

    // Publicar planilla: copia planillaTmp a planillaPublicada y limpia temporal
    function publicarPlanilla(){
      if(planillaTmp.length===0) return alert('No hay turnos para publicar');
      // Copiar (clon) y marcar como publicados
      planillaPublicada = planillaTmp.map(t=>({...t}));
      planillaTmp = [];
      renderTablaTurnos();
      renderPlanillaPublicada();
      alert('Planilla publicada con éxito (simulado)');
    }

    // Renderiza planilla publicada (para gerente)
    function renderPlanillaPublicada(){
      const tbody = document.querySelector('#tablePublicada tbody');
      tbody.innerHTML = '';
      planillaPublicada.forEach(t=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.empleado}</td><td>${t.fecha}</td><td>${t.inicio}</td><td>${t.fin}</td><td>${t.cargo}</td><td>${t.area}</td>`;
        tbody.appendChild(tr);
      })
      // actualizar home info
      document.getElementById('homePlanillaInfo').innerText = planillaPublicada.length + ' turnos publicados';
    }

    // Exporta planilla publicada a CSV (descarga)
    function exportCsv(){
      const rows = planillaPublicada.length?planillaPublicada:planillaTmp;
      if(rows.length===0) return alert('No hay datos para exportar');
      const csv = ['empleado,fecha,inicio,fin,cargo,area', ...rows.map(r=>`${r.empleado},${r.fecha},${r.inicio},${r.fin},${r.cargo},${r.area}`)].join('\n');
      const blob = new Blob([csv],{type:'text/csv'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = 'planilla.csv'; a.click();
      URL.revokeObjectURL(url);
    }

    function clearPlanilla(){
      if(!confirm('Limpiar planilla temporal?')) return;
      planillaTmp = [];
      renderTablaTurnos();
    }

    /* ---------- CSV UPLOAD (simple) ---------- */
    // El mockup acepta CSV con columnas: nombre,fecha,inicio,fin,cargo,area
    function handleCsvUpload(e){
      const file = e.target.files[0];
      if(!file) return;
      const reader = new FileReader();
      reader.onload = ()=>{
        const text = reader.result;
        parseCsvToPlanilla(text);
      }
      reader.readAsText(file,'UTF-8');
    }

    function parseCsvToPlanilla(text){
      // split by lines, quitar encabezados si detecta 'nombre' o 'empleado'
      const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(l=>l.length>0);
      if(lines.length===0) return alert('CSV vacío');
      const header = lines[0].toLowerCase();
      let start = 0;
      if(header.includes('empleado')||header.includes('nombre')) start = 1; // omitir header

      for(let i=start;i<lines.length;i++){
        const cols = lines[i].split(',').map(c=>c.trim());
        // defensivo: si no tiene suficientes columnas, ignora
        if(cols.length < 4) continue;
        const emp = cols[0] || 'sin nombre';
        const fecha = cols[1] || '';
        const inicio = cols[2] || '';
        const fin = cols[3] || '';
        const cargo = cols[4] || 'Crew';
        const area = cols[5] || '';
        planillaTmp.push({empleado:emp, fecha, inicio, fin, cargo, area});
      }
      renderTablaTurnos();
      // mostrar preview resumido
      document.getElementById('csvPreview').style.display='block';
      document.getElementById('csvPreview').innerText = `Se cargaron ${planillaTmp.length} filas (temporal). Revise antes de publicar.`;
    }

    function previewPlanilla(){
      nav('planificar');
      document.getElementById('csvPreview').style.display = planillaTmp.length? 'block' : 'none';
    }

    /* ---------- SOLICITUDES DE CAMBIO (Crew -> Gerente) ---------- */
    function populateMisTurnosSelect(){
      const sel = document.getElementById('selectMisTurnos');
      sel.innerHTML = '';
      if(!currentUser) return;
      const mis = planillaPublicada.filter(t=>t.empleado.toLowerCase() === currentUser.name.toLowerCase());
      if(mis.length===0){
        const opt = document.createElement('option'); opt.text='(No tienes turnos publicados)'; opt.value=''; sel.appendChild(opt); return;
      }
      mis.forEach((t,i)=>{
        const opt = document.createElement('option');
        opt.value = i; opt.text = `${t.fecha} - ${t.inicio} a ${t.fin} (${t.area||t.cargo})`;
        sel.appendChild(opt);
      })
    }

    function enviarSolicitud(){
      if(!currentUser) return alert('Debes iniciar sesión');
      const sel = document.getElementById('selectMisTurnos');
      if(!sel.value) return alert('Selecciona un turno válido');
      const mis = planillaPublicada.filter(t=>t.empleado.toLowerCase()===currentUser.name.toLowerCase());
      const turnoOriginal = mis[parseInt(sel.value)];
      const sugFecha = document.getElementById('sugFecha').value;
      const sugInicio = document.getElementById('sugInicio').value;
      const sugFin = document.getElementById('sugFin').value;
      const motivo = document.getElementById('motivoCambio').value.trim();
      if(!sugFecha||!sugInicio||!sugFin||!motivo) return alert('Completa los campos');

      const solicitud = {
        id: Date.now(),
        empleado: currentUser.name,
        turnoOriginal: `${turnoOriginal.fecha} ${turnoOriginal.inicio}-${turnoOriginal.fin}`,
        turnoPedido: `${sugFecha} ${sugInicio}-${sugFin}`,
        motivo,
        estado: 'Pendiente',
        fechaSolicitud: new Date().toLocaleString()
      };
      solicitudes.push(solicitud);
      document.getElementById('homeSolicitudesInfo').innerText = solicitudes.filter(s=>s.estado==='Pendiente').length;
      alert('Solicitud enviada (simulado)');
      nav('home');
    }

    // Render solicitudes para el gerente
    function renderSolicitudes(){
      const tbody = document.querySelector('#tableSolicitudes tbody');
      tbody.innerHTML = '';
      solicitudes.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.empleado}</td><td>${s.turnoOriginal}</td><td>${s.turnoPedido}</td><td>${s.motivo}</td><td>${s.estado}</td><td class='actions'>
          <button class='btn success' onclick='aprobarSolicitud(${s.id})'>Aprobar</button>
          <button class='btn' onclick='rechazarSolicitud(${s.id})'>Rechazar</button>
        </td>`;
        tbody.appendChild(tr);
      })
    }

    function aprobarSolicitud(id){
      const s = solicitudes.find(x=>x.id===id); if(!s) return;
      if(!confirm('Aprobar solicitud?')) return;
      s.estado = 'Aprobado';
      // NOTA: En un sistema real aquí se haría la reasignación de turnos.
      // En este mockup solo cambiamos el estado y lo reflejamos en historial.
      renderSolicitudes();
      document.getElementById('homeSolicitudesInfo').innerText = solicitudes.filter(s=>s.estado==='Pendiente').length;
      alert('Solicitud aprobada (simulado)');
    }
    function rechazarSolicitud(id){
      const s = solicitudes.find(x=>x.id===id); if(!s) return;
      if(!confirm('Rechazar solicitud?')) return;
      s.estado = 'Rechazado';
      renderSolicitudes();
      document.getElementById('homeSolicitudesInfo').innerText = solicitudes.filter(s=>s.estado==='Pendiente').length;
    }

    /* ---------- VISTAS PERSONALES (Crew) ---------- */
    function renderMiPlanilla(){
      const tbody = document.querySelector('#tableMiPlanilla tbody');
      tbody.innerHTML = '';
      if(!currentUser) return;
      const mis = planillaPublicada.filter(t=>t.empleado.toLowerCase()===currentUser.name.toLowerCase());
      mis.forEach((t,i)=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${t.fecha}</td><td>${t.inicio}</td><td>${t.fin}</td><td>${t.cargo}</td><td>${t.area}</td><td><button class='btn btn-sec' onclick="nav('solicitarCambio')">Solicitar cambio</button></td>`;
        tbody.appendChild(tr);
      })
    }

    function renderHistorial(){
      const tbody = document.querySelector('#tableHistorial tbody');
      tbody.innerHTML = '';
      const mine = currentUser ? solicitudes.filter(s=>s.empleado.toLowerCase()===currentUser.name.toLowerCase()) : [];
      mine.forEach(s=>{
        const tr = document.createElement('tr');
        tr.innerHTML = `<td>${s.fechaSolicitud}</td><td>${s.turnoOriginal}</td><td>${s.turnoPedido}</td><td>${s.estado}</td>`;
        tbody.appendChild(tr);
      })
    }

    /* ---------- UTILIDADES / DEMO ---------- */
    // Cargar demo rápido para presentar
    function seedDemo(){
      // planilla demo
      planillaTmp = [
        {empleado:'Constanza', fecha:'2025-10-28', inicio:'08:00', fin:'13:00', cargo:'Crew', area:'Caja'},
        {empleado:'Juan Perez', fecha:'2025-10-28', inicio:'15:00', fin:'20:00', cargo:'Crew', area:'Cocina'},
        {empleado:'María López', fecha:'2025-10-28', inicio:'09:00', fin:'17:00', cargo:'Entrenador', area:'Sala'}
      ];
      renderTablaTurnos();
      alert('Demo cargado: ahora puedes iniciar sesión como Gerente y publicar la planilla, o iniciar como Crew para ver tu planilla.');
    }

    // Si el usuario publica, actualizar las vistas y disponibilidad
    function renderPlanillaPublicada(){
      renderPlanillaPublicada(); // llamada recursiva intencional? <- corregir: llamamos al método definido arriba
    }

    // Pequeño fix: la función anterior accidentalmente se llama a sí misma, arreglamos:
    // (reemplacé la llamada por la implementación correcta ya definida: renderPlanillaPublicada)

    // Al iniciar mostrar login
    nav('login');
  </script>
</body>
</html>
